<head>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/css/materialize.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.6/font/material-design-icons/Material-Design-Icons.woff" rel="stylesheet">
  <title>Admin Dashboard</title>
  <style>
    header,
main,
footer {
  padding-left: 240px;
}

body {
  backgroud: white;
}

@media only screen and (max-width: 992px) {
  header,
  main,
  footer {
    padding-left: 0;
  }
}

#credits li,
#credits li a {
  color: white;
}

#credits li a {
  font-weight: bold;
}

.footer-copyright .container,
.footer-copyright .container a {
  color: #BCC2E2;
}

.fab-tip {
  position: fixed;
  right: 85px;
  padding: 0px 0.5rem;
  text-align: right;
  background-color: #323232;
  border-radius: 2px;
  color: #FFF;
  width: auto;
}
  </style>
</head>

<body>


  <ul id="slide-out" class="side-nav fixed z-depth-2">
    <li class="center no-padding">
      <div class="  red darken-4 white-text" style="height: 180px;">
        <div class="row">
          <i class="large material-icons">account_circle</i>

          <p style="margin-top: 0%;" id="username">
            Admin
          </p>
        </div>
      </div>
    </li>

    <li id="dash_dashboard"><a class="waves-effect" href="#!"><b>Dashboard</b></a></li>

    <ul class="collapsible" data-collapsible="accordion">
      <li id="dash_users">
        <div id="dash_users_header" class="collapsible-header waves-effect"><b>Admin</b></div>
        <div id="dash_users_body" class="collapsible-body">
          <ul>
            <li id="users_seller">
              <a href="#test-swipe-1" class="waves-effect" style="text-decoration: none;">Profile</a>
            </li>

            <li id="users_customer">
              <a href="#test-swipe-2" class="waves-effect" style="text-decoration: none;">Users</a>
            </li>
            <li id="users_customer">
              <a href="#test-swipe-3" class="waves-effect" style="text-decoration: none;">Investments made</a>
            </li>
          </ul>
        </div>
      </li>

      <li id="dash_products">
        <div id="btn_logout" class="collapsible-header waves-effect"><b>Logout</b></div>
      </li>

    </ul>
  </ul> 

  <header>
    <ul class="dropdown-content" id="user_dropdown">
      <li><a class="red-text text-darken-4" href="">Profile</a></li>
      <li id="btn_logout"><a href="index.html" class="red-text text-darken-4" id="btn_logout">Logout</a></li>
    </ul>

    <nav class="  red darken-4" role="navigation">
      <div class="nav-wrapper">
        <a data-activates="slide-out" class="button-collapse show-on-" href="#!"><img style="margin-top: 17px; margin-left: 5px;" src="logo.png" height="40px" /></a>

        <ul class="right hide-on-med-and-down">
          <li>
            <a class='right dropdown-button' href='' data-activates='user_dropdown'><i class='material-icons'>account_circle</i></a>
          </li>
        </ul>

        <a href="#" data-activates="slide-out" class="button-collapse"><i class="mdi-navigation-menu"></i></a>
      </div>
    </nav>

    <nav>
      <div class="nav-wrapper   red darken-4 darken-2">
        <a style="margin-left: 20px;" class="breadcrumb" href="#">Admin</a>
        <a class="breadcrumb" href="" id="username"></a>

        <div style="margin-right: 20px;" id="timestamp" class="right"></div>
      </div>
    </nav>
  </header>

  <main>
    <div class="row">
      <div class="col s12">
        <div style="padding: 10px; min-height:700px" class="card">
          <div class="row">
            <div class="left card-title">
              <h4 class="red-text text-darken-4">Account</h4>
            </div>
          </div>

          <ul id="tabs-swipe-demo" class="tabs" style="overflow: hidden;">
            <li class="tab col s3">
              <a href="#test-swipe-1" class="active red-text text-darken-4">Profile</a></li>
            <li class="tab col s3"><a class="red-text text-darken-4"" href="#test-swipe-2">User List</a></li>
            <li class="tab col s3"><a href="#test-swipe-3" class="red-text text-darken-4" >Investments made</a></li>
          </ul>

          <div id="test-swipe-1" class="col s12">
            <div id="user_pane">
              <h3>Details</h3>
              <div class="row">
                <table class="center highlight responsive-table">
                <thead><tr>
                  <td>Username</td><td>E-mail</td><td>Full Name</td><td>Phone</td>
                </tr></thead>
                <tbody><tr>
                  <td id="table_username"></td><td id="table_email"></td><td id="table_fullname"></td><td id="table_phone"></td>
                </tr><tbody>
              </table>
             </div>
             <br/><br/>
             <div id="ref_stucture"></div>
            </div>
          </div>

          <div id="test-swipe-2" class="col s12">
            <div id="investment_pane">
              <div class="input-field col s3">
                <input id="search_box" type="text">
                <label for="search_box">Search Username</label>
              </div>
              <table class="responsive-table highlight striped">
                  <thead><tr>
                    <td>Username</td><td>Full Name</td><td>E-mail</td><td>Level</td><td>Account Created</td>Rank</td><td>Set Rank</td>
                  </tr></thead>
                  <tbody id="user_body">
                  <tr>
                    <td id="table_investment"></td><td id="table_createdby"></td><td id="table_date"></td><td id="table_status"></td><td id="table_price"></td><td></td>
                  </tr>
                  <tbody>
                </table>
              </div>
            </div>
          
          <div id="test-swipe-3" class="col s12">
            <div id="current_pane">
              <h3>Pending Investments</h3>
              <div class="center">
                <table class="responsive-table highlight">
                  <thead><tr>
                    <td>Investment</td><td>Created By</td><td>Date</td><td>Status</td><td></td>
                  </tr></thead>
                  <tbody id="wallet_body">
                  <tr>
                    <td id="table_investment"></td><td id="table_createdby"></td><td id="table_date"></td><td id="table_status"></td><td id="table_price"></td>
                  </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          
        </div>
      </div>

      <br/><br/>
    

    

    
    

    <div class="fixed-action-btn click-to-toggle" style="bottom: 45px; right: 24px;">
      <a class="btn-floating btn-large pink waves-effect waves-light">
        <i class="large material-icons">add</i>
      </a>

      <ul>
        <li>
          <a class="btn-floating red"><i class="material-icons">note_add</i></a>
          <a href="" class="btn-floating fab-tip">Add a note</a>
        </li>

        <li>
          <a class="btn-floating yellow darken-1"><i class="material-icons">add_a_photo</i></a>
          <a href="" class="btn-floating fab-tip">Add a photo</a>
        </li>

        <li>
          <a class="btn-floating green"><i class="material-icons">alarm_add</i></a>
          <a href="" class="btn-floating fab-tip">Add an alarm</a>
        </li>

        <li>
          <a class="btn-floating blue"><i class="material-icons">vpn_key</i></a>
          <a href="" class="btn-floating fab-tip">Add a master password</a>
        </li>
      </ul>
    </div>
  </main>

  <footer class="  red darken-4 page-footer">
    <div class="container">
      <div class="row">
        <div class="col s12">
          <h5 class="white-text">Icon Credits</h5>
          <ul id='credits'>
            <li>
              Gif Logo made using <a href="https://formtypemaker.appspot.com/" title="Form Type Maker">Form Type Maker</a> from <a href="https://github.com/romannurik/FORMTypeMaker" title="romannurik">romannurik</a>
            </li>
            <li>
              Icons made by <a href="https://material.io/icons/">Google</a>, available under <a href="https://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License Version 2.0</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
         <span>Made By <a style='font-weight: bold;' href="https://github.com/piedcipher" target="_blank">User</a></span>
      </div>
    </div>
  </footer>
</body>

  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="js/materialize.js"></script>
  <script src="js/init.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    $('.button-collapse').sideNav();

    $('.collapsible').collapsible();

    $('select').material_select();


    $('#btn_logout').click(()=>{
      sessionStorage.clear();
      console.log('logout');
      window.location = 'index.html';
    });

    let d;
    $(function(){
      socket = io();
      username = sessionStorage.getItem('username');
      privilege = sessionStorage.getItem('privilege');
      console.log(username);
      if(!username || privilege != "exec") return window.location = 'login.html';

      Materialize.toast('Welcome ' + username+"!", 4000);

      socket.emit('admindashboard', username);

      socket.on('load', data=>{
        $('#username').html(username);
        $('#table_username').html(username);
        $('#table_email').html(data.email);
        $('#table_fullname').html(data.fullname);
        $('#table_phone').html(data.phone);
      });

      socket.on('walletload', data=>{
        walletid = Object.keys(data);
        str="";
        walletid.forEach(w=>{
          str+='<tr><td>'+data[w].amount+'</td><td>'+data[w].created_by+'</td><td>'+ (new Date(data[w].timestamp)).toDateString() +'<td>'+data[w].status+'</td>'+'<td><a class="btn red approve" id="'+w+'">Approve</a>&nbsp;<a class="btn red reject" id="'+w+'">Reject</a></td>';
        });

        $('#wallet_body').html(str);
        $('.approve').click(e=>{
          socket.emit('updatewallet',{walletid:e.target.id, status:"Approved"});
        });
        $('.reject').click(e=>{
          socket.emit('updatewallet',{walletid:e.target.id, status:"Rejected"});
        });

      });

      socket.on('userload', data=>{
        d= data;
        userid = Object.keys(data);
        str = "";
        userid.forEach(u=>{
          str+='<tr><td>'+u+'</td><td>'+data[u].fullname+'</td><td>'+data[u].email+'</td><td>'+data[u].level+'</td><td>'+(new Date(parseInt(data[u].acc_created))).toDateString()+'</td><td>'+(data[u].rank=="0"?"No Rank":data[u].rank)+'</td><td><a class="btn red setrank" id="'+u+'">Set Rank</a></td></tr>';

        });
        $('#user_body').html(str);

        $('#search_box').on('input',()=>{
          term = $('#search_box').val();
          userid = Object.keys(d);
          if(term != "")
            userid = userid.filter(u=>u.startsWith(term));
          str = "";
          userid.forEach(u=>{
          str+='<tr><td>'+u+'</td><td>'+d[u].fullname+'</td><td>'+d[u].email+'</td><td>'+d[u].level+'</td><td>'+(new Date(parseInt(d[u].acc_created))).toDateString()+'</td><td>'+(d[u].rank=="0"?"No Rank":d[u].rank)+'</td><td><a class="btn red setrank" id="'+u+'">Set Rank</a></td></tr>';
          });
          
          $('#user_body').html(str);          
        });

        $('.setrank').click(e=>{
          newrank = prompt("Enter new rank.");
          if(parseInt(newrank)>=0 && parseInt(newrank) <=25)
            socket.emit("adminupdaterank", {newrank:newrank, username:e.target.id});
          else
            Materialize.toast('You need to enter a valid rank.', 4000);
        });

      });

      socket.on('structure', data=>{
        console.log(data);
        sp = []
        str = "";
        data.forEach(arr=>{
          if(arr=="-->")
            sp.push("<i class='material-icons'>subdirectory_arrow_right</i>");
          else if(arr=="<--")
            sp.shift();
          else{
            str+=sp.join("");
            str+=arr;
            str+="<br/>";
          }
          
        });
        $('#ref_stucture').html(str);
      });

      socket.on('alert',data=>Materialize.toast(data,4000));
      
    });

  </script>
  <style>
    .btn:active{background-color: blue !important;}
  </style>
</html>